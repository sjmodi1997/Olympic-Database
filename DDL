//Smit Modi
CREATE SCHEMA Olympic;
SET SEARCH_PATH TO Olympic;
CREATE TABLE country(
CID int,
cname VARCHAR(20),
PRIMARY KEY(CID)
);
CREATE TABLE Team(
TID int,
tname VARCHAR(20),
CID int,
PRIMARY KEY(TID),
FOREIGN KEY(CID) REFERENCES country(CID)
ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE Athlete (
AID int,
fname VARCHAR(20),
lname VARCHAR(20),
Gender VARCHAR(20),
CID int,
age int,
PRIMARY KEY(AID),
FOREIGN KEY(CID) REFERENCES country(CID)
ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE Olympic(
OID int,
CID int,
Year int,
City VARCHAR(20),
PRIMARY KEY(OID),
FOREIGN KEY(CID) REFERENCES country(CID)
ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE Team_Members(
AID int,
TID int,
PRIMARY KEY(AID,TID),
FOREIGN KEY(AID) REFERENCES Athlete(AID)
ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(TID) REFERENCES Team(TID)
ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE Event (
EID int,
sname VARCHAR(20),
event_type CHAR(4),
supersport VARCHAR(10),
PRIMARY KEY(EID)
);
CREATE TABLE Participates(
PID int,
EID int,
OID int,
Rank int,
AID int NULL,
CONSTRAINT AID_check FOREIGN KEY(AID) REFERENCES Athlete(AID),
TID int NULL,
CONSTRAINT TID_check FOREIGN KEY(TID) REFERENCES Team(TID),
CONSTRAINT PID_check CHECK(
CASE WHEN AID IS NULL THEN 0 ELSE 1 END+
CASE WHEN TID IS NULL THEN 0 ELSE 1 END=1
),
PRIMARY KEY(PID, EID , OID),
FOREIGN KEY(EID) REFERENCES Event(EID)
ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(OID) REFERENCES Olympic(OID)
ON DELETE CASCADE ON UPDATE CASCADE
);
